<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Registro - FitZone</title>
        <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%234b1c71'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='%23dbb6ee' font-family='Arial, sans-serif' font-weight='bold'>F</text></svg>">
        <link rel="stylesheet" href="/css/style.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <script src="/js/alerts.js"></script>
    </head>
    <body>
        <!-- Header simple -->
        <header class="header">
            <nav class="navbar">
                <div class="nav-container">
                    <div class="logo">
                        <i class="fas fa-dumbbell"></i>
                        <span>FitZone</span>
                    </div>
                    <ul class="nav-menu">
                        <li><a href="/">Volver al Inicio</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="register-main">
            <div class="register-container">
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Membresía</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Datos</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Pago</div>
                    </div>
                </div>

                <!-- Step 1: Selección de Membresía -->
                <div id="step-1" class="register-step active">
                    <div class="step-header">
                        <h2>Selecciona tu Membresía</h2>
                        <p>Elige el plan que mejor se adapte a ti</p>
                    </div>

                    <div class="memberships-selector">

                        <div class="membership-option" data-plan="semanal" onclick="selectMembership('semanal')">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Semanal</h3>
                            <p class="price">$11.500/semana</p>
                            <ul>
                                <li>7 días completos</li>
                                <li>Acceso ilimitado</li>
                            </ul>
                        </div>

                        <div class="membership-option" data-plan="dos-personas" onclick="selectMembership('dos-personas')">
                            <i class="fas fa-user-friends"></i>
                            <h3>2 Personas</h3>
                            <p class="price">$28.000 c/u</p>
                            <ul>
                                <li>Para 2 personas</li>
                                <li>Código compartido</li>
                            </ul>
                        </div>

                        <div class="membership-option" data-plan="tres-veces" onclick="selectMembership('tres-veces')">
                            <i class="fas fa-calendar-week"></i>
                            <h3>3 Veces/Semana</h3>
                            <p class="price">$24.000/mes</p>
                            <ul>
                                <li>3 días por semana</li>
                                <li>Horario flexible</li>
                            </ul>
                        </div>

                        <div class="membership-option" data-plan="dia-clase" onclick="selectMembership('dia-clase')">
                            <i class="fas fa-ticket-alt"></i>
                            <h3>Día o Clase</h3>
                            <p class="price">$5.000/día</p>
                            <ul>
                                <li>Sin compromiso</li>
                                <li>Pago por día</li>
                            </ul>
                        </div>

                        <div class="membership-option" data-plan="jubilados" onclick="selectMembership('jubilados')">
                            <i class="fas fa-heart"></i>
                            <h3>Jubilados</h3>
                            <p class="price">$20.000/mes</p>
                            <ul>
                                <li>Mayores 60/65</li>
                                <li>Descuento especial</li>
                            </ul>
                        </div>
                    </div>

                    <div class="membership-join-code">
                        <p>¿Tienes un código de membresía compartida?</p>
                        <button class="btn-secondary" onclick="showJoinCodeForm()">
                            <i class="fas fa-key"></i> Ingresar Código
                        </button>
                    </div>
                </div>

                <!-- Step 2: Formulario de Datos (Dinámico según membresía) -->
                <div id="step-2" class="register-step">
                    <div class="step-header">
                        <h2>Completa tus Datos</h2>
                        <p id="membership-selected-label">Membresía seleccionada</p>
                    </div>

                    <!-- Formulario Estándar (Mes Libre, Día/Clase) -->
                    <form id="form-standard" class="register-form" style="display:none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName">Nombre Completo *</label>
                                <input type="text" id="fullName" required>
                            </div>

                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" required>
                            </div>

                            <div class="form-group">
                                <label for="phone">Teléfono *</label>
                                <input type="tel" id="phone" required>
                            </div>

                            <div class="form-group">
                                <label for="address">Domicilio *</label>
                                <input type="text" id="address" required>
                            </div>

                            <div class="form-group">
                                <label for="password">Contraseña *</label>
                                <input type="password" id="password" required>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirmar Contraseña *</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                        </div>
                    </form>

                    <!-- Formulario 2 Personas -->
                    <form id="form-dos-personas" class="register-form" style="display:none;">
                        <div class="two-person-info">
                            <i class="fas fa-info-circle"></i>
                            <p>Completa los datos de ambas personas. Se generará un código que la segunda persona podrá usar para activar su cuenta.</p>
                        </div>

                        <h3>Datos de la Primera Persona (Tu cuenta)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName1">Nombre Completo *</label>
                                <input type="text" id="fullName1" required>
                            </div>

                            <div class="form-group">
                                <label for="age1">Edad *</label>
                                <input type="number" id="age1" min="18" required>
                            </div>

                            <div class="form-group">
                                <label for="email1">Email *</label>
                                <input type="email" id="email1" required>
                            </div>

                            <div class="form-group">
                                <label for="phone1">Celular *</label>
                                <input type="tel" id="phone1" required>
                            </div>

                            <div class="form-group">
                                <label for="address1">Domicilio *</label>
                                <input type="text" id="address1" required>
                            </div>

                            <div class="form-group">
                                <label for="password1">Contraseña *</label>
                                <input type="password" id="password1" required>
                            </div>
                        </div>

                        <h3>Datos de la Segunda Persona</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName2">Nombre Completo *</label>
                                <input type="text" id="fullName2" required>
                            </div>

                            <div class="form-group">
                                <label for="age2">Edad *</label>
                                <input type="number" id="age2" min="18" required>
                            </div>

                            <div class="form-group">
                                <label for="email2">Email *</label>
                                <input type="email" id="email2" required>
                            </div>

                            <div class="form-group">
                                <label for="phone2">Celular *</label>
                                <input type="tel" id="phone2" required>
                            </div>

                            <div class="form-group">
                                <label for="address2">Domicilio *</label>
                                <input type="text" id="address2" required>
                            </div>
                        </div>
                    </form>

                    <!-- Formulario 3 Veces por Semana -->
                    <form id="form-tres-veces" class="register-form" style="display:none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName-3v">Nombre Completo *</label>
                                <input type="text" id="fullName-3v" required>
                            </div>

                            <div class="form-group">
                                <label for="email-3v">Email *</label>
                                <input type="email" id="email-3v" required>
                            </div>

                            <div class="form-group">
                                <label for="phone-3v">Teléfono *</label>
                                <input type="tel" id="phone-3v" required>
                            </div>

                            <div class="form-group">
                                <label for="address-3v">Domicilio *</label>
                                <input type="text" id="address-3v" required>
                            </div>

                            <div class="form-group">
                                <label for="password-3v">Contraseña *</label>
                                <input type="password" id="password-3v" required>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword-3v">Confirmar Contraseña *</label>
                                <input type="password" id="confirmPassword-3v" required>
                            </div>
                        </div>

                        <div class="days-selector">
                            <h3>Selecciona tus 3 días de entrenamiento</h3>
                            <div class="days-grid">
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="lunes">
                                    <span>Lunes</span>
                                </label>
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="martes">
                                    <span>Martes</span>
                                </label>
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="miercoles">
                                    <span>Miércoles</span>
                                </label>
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="jueves">
                                    <span>Jueves</span>
                                </label>
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="viernes">
                                    <span>Viernes</span>
                                </label>
                                <label class="day-option">
                                    <input type="checkbox" name="trainingDays" value="sabado">
                                    <span>Sábado</span>
                                </label>
                            </div>
                            <p class="days-counter">Días seleccionados: <span id="days-count">0</span>/3</p>
                        </div>
                    </form>

                    <!-- Formulario Jubilados -->
                    <form id="form-jubilados" class="register-form" style="display:none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName-jub">Nombre Completo *</label>
                                <input type="text" id="fullName-jub" required>
                            </div>

                            <div class="form-group">
                                <label for="dni-jub">DNI *</label>
                                <input type="text" id="dni-jub" required>
                            </div>

                            <div class="form-group">
                                <label for="age-jub">Edad *</label>
                                <input type="number" id="age-jub" min="60" required>
                            </div>

                            <div class="form-group">
                                <label for="gender-jub">Género *</label>
                                <select id="gender-jub" required>
                                    <option value="">Seleccionar</option>
                                    <option value="femenino">Femenino (60+ años)</option>
                                    <option value="masculino">Masculino (65+ años)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="email-jub">Email *</label>
                                <input type="email" id="email-jub" required>
                            </div>

                            <div class="form-group">
                                <label for="phone-jub">Celular *</label>
                                <input type="tel" id="phone-jub" required>
                            </div>

                            <div class="form-group">
                                <label for="address-jub">Domicilio *</label>
                                <input type="text" id="address-jub" required>
                            </div>

                            <div class="form-group">
                                <label for="password-jub">Contraseña *</label>
                                <input type="password" id="password-jub" required>
                            </div>
                        </div>

                        <div class="validation-info">
                            <i class="fas fa-info-circle"></i>
                            <p>Se requiere verificación de edad: Mujeres 60+ años, Hombres 65+ años</p>
                        </div>
                    </form>

                    <!-- Formulario para ingresar código -->
                    <form id="form-join-code" class="register-form" style="display:none;">
                        <div class="join-code-info">
                            <i class="fas fa-key"></i>
                            <h3>Unirse con Código de Membresía</h3>
                            <p>Si tu compañero ya se registró, ingresa el código que te compartió para activar tu cuenta en la membresía compartida.</p>
                        </div>

                        <div class="form-group">
                            <label for="join-code">Código de Membresía *</label>
                            <input type="text" id="join-code" placeholder="Ej: FZ-2P-ABC123" required>
                        </div>

                        <div class="form-group">
                            <label for="password-join">Contraseña *</label>
                            <input type="password" id="password-join" required>
                        </div>

                        <button type="button" class="btn-secondary" onclick="verifyJoinCode()">
                            <i class="fas fa-search"></i> Verificar Código
                        </button>

                        <div id="code-result" style="display:none; margin-top: 2rem;">
                            <!-- Se mostrará info del código aquí -->
                        </div>
                    </form>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="goToStep(1)">
                            <i class="fas fa-arrow-left"></i> Volver
                        </button>
                        <button type="button" class="btn-primary" onclick="goToStep(3)">
                            Continuar <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Método de Pago -->
                <div id="step-3" class="register-step">
                    <div class="step-header">
                        <h2>Método de Pago</h2>
                        <p>Selecciona cómo deseas abonar tu membresía</p>
                    </div>

                    <div class="payment-summary">
                        <h3>Resumen de tu Compra</h3>
                        <div class="summary-item">
                            <span>Membresía:</span>
                            <strong id="summary-membership">-</strong>
                        </div>
                        <div class="summary-item">
                            <span>Precio:</span>
                            <strong id="summary-price">$0</strong>
                        </div>
                        <div class="summary-item total">
                            <span>Total a Pagar:</span>
                            <strong id="summary-total">$0</strong>
                        </div>
                    </div>

                    <div class="payment-methods">
                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="efectivo" checked>
                            <div class="payment-card">
                                <i class="fas fa-money-bill-wave"></i>
                                <h4>Efectivo en Sucursal</h4>
                                <p>Paga directamente en nuestras instalaciones</p>
                            </div>
                        </label>

                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="transferencia">
                            <div class="payment-card">
                                <i class="fas fa-university"></i>
                                <h4>Transferencia Bancaria</h4>
                                <p>Enviaremos los datos a tu email</p>
                            </div>
                        </label>

                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="tarjeta">
                            <div class="payment-card">
                                <i class="fas fa-credit-card"></i>
                                <h4>Tarjeta de Crédito/Débito</h4>
                                <p>Pago seguro con tarjeta</p>
                            </div>
                        </label>

                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="mercadopago">
                            <div class="payment-card">
                                <i class="fas fa-shopping-cart"></i>
                                <h4>Mercado Pago</h4>
                                <p>5% de recargo adicional</p>
                                <span class="recargo-badge">+5%</span>
                            </div>
                        </label>
                    </div>

                    <div class="terms-acceptance">
                        <label class="checkbox-label">
                            <input type="checkbox" id="terms" required>
                            <span>Acepto los <a href="#" onclick="showTerms()">términos y condiciones</a> y la <a href="#" onclick="showPrivacy()">política de privacidad</a></span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="goToStep(2)">
                            <i class="fas fa-arrow-left"></i> Volver
                        </button>
                        <button type="button" class="btn-primary" onclick="completeRegistration()">
                            <i class="fas fa-check"></i> Finalizar Registro
                        </button>
                    </div>
                </div>

                <!-- Modal de Código Generado (para 2 personas) -->
                <div id="code-modal" class="modal-overlay" style="display:none;">
                    <div class="modal-box">
                        <div class="modal-header">
                            <h3>¡Membresía Activada!</h3>
                        </div>
                        <div class="modal-body">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <p>Tu membresía compartida ha sido creada exitosamente.</p>
                            <div class="generated-code">
                                <h4>Código para compartir:</h4>
                                <div class="code-display" id="generated-code">FZ-2P-ABC123</div>
                                <button class="btn-copy" onclick="copyCode()">
                                    <i class="fas fa-copy"></i> Copiar Código
                                </button>
                            </div>
                            <p class="code-instructions">Comparte este código con tu compañero para que active su cuenta.</p>
                        </div>
                        <div class="modal-actions">
                            <button class="btn-primary" onclick="closeCodeModal()">
                                Ir al Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        // ==================== SCRIPT CORREGIDO PARA REGISTER.HTML ====================
    // Reemplazar el script al final de register.html

        <script>
            let selectedMembership = null;
            let selectedDays = [];
            const membershipPrices = {
                'mes-libre': 32000,
                'dos-personas': 28000,
                'tres-veces': 24000,
                'semanal': 11500,
                'dia-clase': 5000,
                'jubilados': 20000
            };

            // IMPORTANTE: Limpiar localStorage y siempre empezar en paso 1
            window.addEventListener('DOMContentLoaded', function() {
                // Limpiar cualquier plan anterior
                localStorage.removeItem('selectedPlan');
                selectedMembership = null;
                
                // Limpiar selecciones visuales
                document.querySelectorAll('.membership-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Siempre empezar en el paso 1
                goToStep(1);
                
                // Si viene un plan por URL, solo marcarlo visualmente pero NO seleccionarlo automáticamente
                const urlParams = new URLSearchParams(window.location.search);
                const planFromUrl = urlParams.get('plan');
                if (planFromUrl) {
                    const planElement = document.querySelector(`[data-plan="${planFromUrl}"]`);
                    if (planElement) {
                        // Solo agregar un borde destacado, no seleccionar
                        planElement.style.boxShadow = '0 0 30px rgba(183, 126, 220, 0.6)';
                    }
                }
            });

            // Seleccionar membresía
            function selectMembership(plan) {
                selectedMembership = plan;
                localStorage.setItem('selectedPlan', plan);
                
                // Marcar visualmente la selección
                document.querySelectorAll('.membership-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.style.boxShadow = '';
                });
                const selectedElement = document.querySelector(`[data-plan="${plan}"]`);
                if (selectedElement) {
                    selectedElement.classList.add('selected');
                }
                
                // Actualizar label
                const labels = {
                    'mes-libre': 'Mes Libre - $32.000/mes',
                    'dos-personas': '2 Personas - $28.000 c/u',
                    'tres-veces': '3 Veces por Semana - $24.000/mes',
                    'semanal': 'Semanal - $11.500/semana',
                    'dia-clase': 'Día o Clase - $5.000/día',
                    'jubilados': 'Jubilados - $20.000/mes'
                };
                document.getElementById('membership-selected-label').textContent = labels[plan];
                
                // Mostrar formulario correspondiente
                document.querySelectorAll('.register-form').forEach(form => form.style.display = 'none');
                
                if (plan === 'dos-personas') {
                    document.getElementById('form-dos-personas').style.display = 'block';
                } else if (plan === 'tres-veces') {
                    document.getElementById('form-tres-veces').style.display = 'block';
                } else if (plan === 'jubilados') {
                    document.getElementById('form-jubilados').style.display = 'block';
                } else {
                    document.getElementById('form-standard').style.display = 'block';
                }
                
                // Actualizar resumen de pago
                updatePaymentSummary();
                
                // Mostrar mensaje de éxito
                showCustomAlert('success', '¡Membresía Seleccionada!', `Has elegido el plan: ${labels[plan]}`);
            }

            // Navegación entre pasos
            function goToStep(stepNumber) {
                // Validar antes de avanzar
                if (stepNumber === 2 && !selectedMembership) {
                    showCustomAlert('warning', 'Membresía Requerida', 'Por favor selecciona una membresía antes de continuar.');
                    return;
                }
                
                if (stepNumber === 3) {
                    if (!validateCurrentForm()) {
                        return;
                    }
                }
                
                // Ocultar todos los pasos
                document.querySelectorAll('.register-step').forEach(step => {
                    step.classList.remove('active');
                });
                
                // Mostrar paso seleccionado
                document.getElementById(`step-${stepNumber}`).classList.add('active');
                
                // Actualizar indicadores de progreso
                document.querySelectorAll('.step').forEach(step => {
                    const num = parseInt(step.dataset.step);
                    if (num < stepNumber) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (num === stepNumber) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
                
                // Scroll al inicio
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Validar formulario actual
            function validateCurrentForm() {
                const plan = selectedMembership;
                
                if (plan === 'tres-veces') {
                    const checkedDays = document.querySelectorAll('input[name="trainingDays"]:checked');
                    if (checkedDays.length !== 3) {
                        showCustomAlert('warning', 'Días Incompletos', 'Debes seleccionar exactamente 3 días de entrenamiento.');
                        return false;
                    }
                    selectedDays = Array.from(checkedDays).map(cb => cb.value);
                }
                
                if (plan === 'jubilados') {
                    const age = parseInt(document.getElementById('age-jub').value);
                    const gender = document.getElementById('gender-jub').value;
                    
                    if (gender === 'femenino' && age < 60) {
                        showCustomAlert('error', 'Edad No Válida', 'Para la membresía de jubilados, las mujeres deben tener 60 años o más.');
                        return false;
                    }
                    
                    if (gender === 'masculino' && age < 65) {
                        showCustomAlert('error', 'Edad No Válida', 'Para la membresía de jubilados, los hombres deben tener 65 años o más.');
                        return false;
                    }
                }
                
                return true;
            }

            // Actualizar resumen de pago
            function updatePaymentSummary() {
                if (!selectedMembership) return;
                
                const labels = {
                    'mes-libre': 'Mes Libre',
                    'dos-personas': '2 Personas',
                    'tres-veces': '3 Veces por Semana',
                    'semanal': 'Semanal',
                    'dia-clase': 'Día o Clase',
                    'jubilados': 'Jubilados'
                };
                
                let price = membershipPrices[selectedMembership];
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;
                
                // Aplicar recargo de Mercado Pago
                if (paymentMethod === 'mercadopago') {
                    price = price * 1.05;
                }
                
                document.getElementById('summary-membership').textContent = labels[selectedMembership];
                document.getElementById('summary-price').textContent = `$${price.toLocaleString()}`;
                document.getElementById('summary-total').textContent = `$${price.toLocaleString()}`;
            }

            // Escuchar cambios en método de pago
            document.addEventListener('change', function(e) {
                if (e.target.name === 'paymentMethod') {
                    updatePaymentSummary();
                }
            });

            // Contador de días para 3 veces por semana
            document.addEventListener('change', function(e) {
                if (e.target.name === 'trainingDays') {
                    const checked = document.querySelectorAll('input[name="trainingDays"]:checked').length;
                    document.getElementById('days-count').textContent = checked;
                    
                    const allCheckboxes = document.querySelectorAll('input[name="trainingDays"]');
                    allCheckboxes.forEach(cb => {
                        if (!cb.checked && checked >= 3) {
                            cb.disabled = true;
                        } else {
                            cb.disabled = false;
                        }
                    });
                }
            });

            // Completar registro
            async function completeRegistration() {
                // Validar términos
                if (!document.getElementById('terms').checked) {
                    showCustomAlert('warning', 'Términos Requeridos', 'Debes aceptar los términos y condiciones para continuar.');
                    return;
                }
                
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                let registrationData = {
                    membershipPlan: selectedMembership,
                    paymentMethod: paymentMethod,
                    trainingDays: selectedDays
                };
                
                // Recopilar datos según el tipo de membresía
                if (selectedMembership === 'dos-personas') {
                    registrationData.person1 = {
                        fullName: document.getElementById('fullName1').value,
                        age: document.getElementById('age1').value,
                        email: document.getElementById('email1').value,
                        phone: document.getElementById('phone1').value,
                        address: document.getElementById('address1').value,
                        password: document.getElementById('password1').value
                    };
                    registrationData.person2 = {
                        fullName: document.getElementById('fullName2').value,
                        age: document.getElementById('age2').value,
                        email: document.getElementById('email2').value,
                        phone: document.getElementById('phone2').value,
                        address: document.getElementById('address2').value
                    };
                } else if (selectedMembership === 'tres-veces') {
                    registrationData.fullName = document.getElementById('fullName-3v').value;
                    registrationData.email = document.getElementById('email-3v').value;
                    registrationData.phone = document.getElementById('phone-3v').value;
                    registrationData.address = document.getElementById('address-3v').value;
                    registrationData.password = document.getElementById('password-3v').value;
                } else if (selectedMembership === 'jubilados') {
                    registrationData.fullName = document.getElementById('fullName-jub').value;
                    registrationData.dni = document.getElementById('dni-jub').value;
                    registrationData.age = document.getElementById('age-jub').value;
                    registrationData.gender = document.getElementById('gender-jub').value;
                    registrationData.email = document.getElementById('email-jub').value;
                    registrationData.phone = document.getElementById('phone-jub').value;
                    registrationData.address = document.getElementById('address-jub').value;
                    registrationData.password = document.getElementById('password-jub').value;
                } else {
                    registrationData.fullName = document.getElementById('fullName').value;
                    registrationData.email = document.getElementById('email').value;
                    registrationData.phone = document.getElementById('phone').value;
                    registrationData.address = document.getElementById('address').value;
                    registrationData.password = document.getElementById('password').value;
                }
                
                try {
                    const response = await fetch('/api/register-with-membership', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(registrationData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        if (selectedMembership === 'dos-personas' && result.membershipCode) {
                            document.getElementById('generated-code').textContent = result.membershipCode;
                            document.getElementById('code-modal').style.display = 'flex';
                        } else {
                            showCustomAlert('success', '¡Registro Exitoso!', 'Tu cuenta ha sido creada correctamente. Serás redirigido al login.', 
                                () => {
                                    setTimeout(() => {
                                        window.location.href = '/login';
                                    }, 1500);
                                }
                            );
                        }
                    } else {
                        showCustomAlert('error', 'Error en Registro', result.message || 'Hubo un problema al procesar tu registro. Por favor intenta nuevamente.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showCustomAlert('error', 'Error de Conexión', 'No se pudo conectar con el servidor. Verifica tu conexión e intenta nuevamente.');
                }
            }

            // Funciones adicionales
            function showJoinCodeForm() {
                goToStep(2);
                document.querySelectorAll('.register-form').forEach(form => form.style.display = 'none');
                document.getElementById('form-join-code').style.display = 'block';
                document.getElementById('membership-selected-label').textContent = 'Unirse con código de membresía';
            }

            async function verifyJoinCode() {
                const code = document.getElementById('join-code').value.trim();
                
                if (!code) {
                    showCustomAlert('warning', 'Código Requerido', 'Por favor ingresa el código de membresía.');
                    return;
                }
                
                try {
                    const response = await fetch('/api/verify-membership-code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        const resultDiv = document.getElementById('code-result');
                        resultDiv.innerHTML = `
                            <div class="code-verified">
                                <i class="fas fa-check-circle"></i>
                                <h4>Código Válido</h4>
                                <p>Te unirás a la membresía de: <strong>${result.membershipInfo.ownerName}</strong></p>
                                <p>Membresía: <strong>${result.membershipInfo.plan}</strong></p>
                                <button class="btn-primary" onclick="activateWithCode('${code}')">
                                    Activar mi Cuenta
                                </button>
                            </div>
                        `;
                        resultDiv.style.display = 'block';
                    } else {
                        showCustomAlert('error', 'Código Inválido', result.message || 'El código ingresado no es válido o ya fue utilizado.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showCustomAlert('error', 'Error de Conexión', 'No se pudo verificar el código. Intenta nuevamente.');
                }
            }

            async function activateWithCode(code) {
                const password = document.getElementById('password-join').value;
                
                if (!password) {
                    showCustomAlert('warning', 'Contraseña Requerida', 'Por favor ingresa una contraseña para tu cuenta.');
                    return;
                }
                
                try {
                    const response = await fetch('/api/activate-with-code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code, password })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showCustomAlert('success', '¡Cuenta Activada!', 'Tu cuenta ha sido activada exitosamente. Serás redirigido al login.',
                            () => {
                                setTimeout(() => {
                                    window.location.href = '/login';
                                }, 1500);
                            }
                        );
                    } else {
                        showCustomAlert('error', 'Error de Activación', result.message || 'No se pudo activar la cuenta. Intenta nuevamente.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showCustomAlert('error', 'Error de Conexión', 'No se pudo activar la cuenta. Verifica tu conexión.');
                }
            }

            function copyCode() {
                const code = document.getElementById('generated-code').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    showCustomAlert('success', 'Código Copiado', 'El código ha sido copiado al portapapeles.');
                });
            }

            function closeCodeModal() {
                showCustomAlert('success', 'Registro Completo', 'Tu registro ha sido exitoso. Serás redirigido al login.',
                    () => {
                        setTimeout(() => {
                            window.location.href = '/login';
                        }, 1500);
                    }
                );
            }

            function showTerms() {
                event.preventDefault();
                showCustomAlert('info', 'Términos y Condiciones', 
                    '1. Membresías renovables mensualmente<br>2. Sin permanencia mínima<br>3. Cancelación disponible con 7 días de anticipación<br>4. Acceso según membresía contratada'
                );
            }

            function showPrivacy() {
                event.preventDefault();
                showCustomAlert('info', 'Política de Privacidad', 
                    'Tus datos personales están protegidos y solo se utilizarán para gestionar tu membresía en FitZone.'
                );
            }
        </script>
    </body>
</html>